{% extends "base.html" %}
{% load static %}

{% block title %}Gesti√≥n de Personal{% endblock %}

{% block content %}
<div class="personal-container">
  <header class="personal-header">
    <h1><i class="fa-solid fa-users"></i> Gesti√≥n de Personal</h1>
    <a href="{% url 'usuario:dashboard' %}" class="btn btn-back">
      <i class="fa-solid fa-arrow-left"></i> Volver
    </a>
  </header>

  <!-- Formulario de alta -->
  <section class="panel form-panel">
    <h3><i class="fa-solid fa-user-plus"></i> Agregar nuevo empleado</h3>
    <form method="post" class="personal-form">
      {% csrf_token %}
      <div class="form-grid">
        {{ form.as_p }}
      </div>
      <button type="submit" name="agregar" class="btn btn-success">
        <i class="fa-solid fa-plus"></i> Agregar
      </button>
    </form>
  </section>

  <!-- Lista -->
  <section class="panel list-panel">
    <h3><i class="fa-solid fa-list"></i> Lista de empleados</h3>

    <table class="tabla-personal">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Cargo</th>
          <th>Ubicaci√≥n / Sede</th> <!-- üëà Nueva columna -->
          <th>Fecha ingreso</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for empleado in empleados %}
        <tr>
          <td>{{ empleado.id }}</td>
          <td>{{ empleado.nombre }}</td>
          <td>{{ empleado.apellido }}</td>
          <td>{{ empleado.cargo }}</td>
          <td>
            {% if empleado.ubicacion %}
              {{ empleado.ubicacion.nombre_sede }}
            {% else %}
              <em>Sin asignar</em>
            {% endif %}
          </td>
          <td>{{ empleado.fecha_ingreso|date:"d/m/Y" }}</td>
          <td class="acciones">
            <a href="{% url 'usuario:editar_personal' empleado.id %}" class="btn btn-primary">
              <i class="fa-solid fa-pen"></i>
            </a>
            <form method="post" style="display:inline;" onsubmit="return confirm('¬øSeguro que deseas eliminar este empleado?');">
              {% csrf_token %}
              <input type="hidden" name="id" value="{{ empleado.id }}">
              <button type="submit" name="eliminar" class="btn btn-danger">
                <i class="fa-solid fa-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="7" class="sin-datos">No hay empleados cargados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}
