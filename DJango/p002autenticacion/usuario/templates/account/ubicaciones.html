{% extends "base.html" %}
{% load static %}

{% block title %}Gestión de Ubicaciones Biométricas{% endblock %}

{% block content %}
<a href="{% url 'usuario:dashboard' %}" class="btn-volver" title="Volver al inicio">
  <i class="fa-solid fa-arrow-left"></i>
</a>

<header>
  <h1><i class="fa-solid fa-map-location-dot"></i> Panel de Gestión de Ubicaciones</h1>
  <p>Utiliza este formulario para registrar nuevas sedes, oficinas y áreas de acceso.</p>
</header>

<div class="main-container">

  <!-- Panel para agregar ubicaciones -->
  <div class="add-panel">
    <h2><i class="fa-solid fa-plus-circle"></i> Agregar Ubicación</h2>

    {% if messages %}
      {% for message in messages %}
        <div class="mensaje-{{ message.tags }}">
          <i class="fa-solid fa-check"></i> {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <form method="post" id="formularioUbicacion">
      {% csrf_token %}
      <fieldset>
        <legend><i class="fa-solid fa-building"></i> Información de la Sede</legend>

        <div class="form-group">
          <label for="id_tipo_ubicacion"><i class="fa-solid fa-layer-group"></i> Tipo de Ubicación: <span class="required">*</span></label>
          {{ form.tipo_ubicacion }}
        </div>

        <div class="form-group">
          <label for="id_nombre_sede"><i class="fa-solid fa-signature"></i> Nombre de la Ubicación: <span class="required">*</span></label>
          {{ form.nombre_sede }}
        </div>

        <div class="form-group">
          <label for="id_codigo_unico"><i class="fa-solid fa-barcode"></i> Código Único (ID): <span class="required">*</span></label>
          {{ form.codigo_unico }}
        </div>

        <div class="form-group">
          <label for="id_direccion"><i class="fa-solid fa-location-dot"></i> Dirección Completa:</label>
          {{ form.direccion }}
        </div>

        <div class="form-group">
          <label for="id_descripcion"><i class="fa-solid fa-align-left"></i> Descripción Adicional:</label>
          {{ form.descripcion }}
        </div>
      </fieldset>

      <fieldset>
        <legend><i class="fa-solid fa-fingerprint"></i> Configuración de Seguridad Biométrica</legend>

        <div class="form-group">
          <label for="id_dispositivo_biometrico"><i class="fa-solid fa-microchip"></i> Tipo de Dispositivo Biométrico:</label>
          {{ form.dispositivo_biometrico }}
        </div>

        <div class="form-group">
          <label for="id_nivel_seguridad"><i class="fa-solid fa-shield-halved"></i> Nivel de Seguridad:</label>
          {{ form.nivel_seguridad }}
        </div>
      </fieldset>

      <button type="submit" class="btn"><i class="fa-solid fa-floppy-disk"></i> Guardar Cambios</button>
    </form>
  </div>

  <!-- Panel para listar ubicaciones -->
  <div class="list-panel">
    <div class="header-actions">
      <h2><i class="fa-solid fa-list-check"></i> Ubicaciones Registradas</h2>

      <div class="dropdown">
        <button class="dropdown-toggle" id="dropdownMenuButton">Opciones</button>
        <div class="dropdown-menu" id="dropdownMenu">
          <a class="dropdown-item" id="opcion-filtros">Mostrar/Ocultar Filtros</a>
          <a class="dropdown-item" id="opcion-modificar-todo">Modificar Todo</a>
          <a class="dropdown-item" id="opcion-eliminar-todo">Eliminar Todo</a>
        </div>
      </div>
    </div>

    <!-- Filtros -->
    <div class="filter-section" id="filtros" style="display: none;">
      <input type="text" id="filtro-nombre" placeholder="Filtrar por nombre">
      <select id="filtro-tipo">
        <option value="">Todos los tipos</option>
        <option value="sede">Sede</option>
        <option value="oficina">Oficina</option>
        <option value="area">Área</option>
      </select>
      <select id="filtro-dispositivo">
        <option value="">Todos los dispositivos</option>
        <option value="huella">Lector de Huella</option>
        <option value="Tarjeta">Tarjeta de Acceso</option>
        <option value="PIN">PIN</option>
      </select>
      <button id="btn-limpiar-filtros" class="btn-accion">Limpiar Filtros</button>
    </div>

    <!-- Tabla -->
    <div class="tabla-container">
      <table id="tablaUbicaciones">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Dispositivo</th>
            <th>Seguridad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpoTabla">
          {% for ubicacion in ubicaciones %}
          <tr>
            <td>{{ ubicacion.codigo_unico }}</td>
            <td>{{ ubicacion.nombre_sede }}</td>
            <td>{{ ubicacion.get_tipo_ubicacion_display }}</td>
            <td>{{ ubicacion.get_dispositivo_biometrico_display|default:"—" }}</td>
            <td>{{ ubicacion.get_nivel_seguridad_display|default:"—" }}</td>
            <td>
              <a href="#" class="btn-accion"><i class="fa-solid fa-pen"></i></a>
              <a href="#" class="btn-accion"><i class="fa-solid fa-trash"></i></a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="empty-state">
              <i class="fa-solid fa-inbox"></i> No hay ubicaciones registradas aún
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="soporte-info">
  <i class="fa-solid fa-headset"></i> <strong>¿Necesita ayuda?</strong><br>
  Contacte con Soporte Técnico al <strong>4666-1212</strong> o al correo 
  <a href="mailto:soporte@biometrika.com">soporte@biometrika.com</a>
</div>

<div class="footer">
  <div>Copyright© Sistema Biométrico 2025</div>
  <div>Versión 1.0</div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'account/js/ubicaciones.js' %}"></script>
<link rel="stylesheet" href="{% static 'account/css/style_ubicacion.css' %}">
{% endblock %}
